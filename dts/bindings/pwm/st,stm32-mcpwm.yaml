description: STM32 Multi-Channel PWM

compatible: "st,stm32-mcpwm"

include: [pwm-controller.yaml, base.yaml, pinctrl-device.yaml]

properties:
  pinctrl-0:
    description: |
      Optional pin control configuration for PWM outputs.
      Required only when using PWM outputs. Can be omitted for timer-only mode
      (e.g., for timer synchronization, trigger generation, or timing without PWM outputs).

  pinctrl-names:
    description: |
      Optional pin control state names.
      Required only when pinctrl-0 is specified for PWM outputs.

  period:
    type: int
    required: true
    description: |
      PWM period in nanoseconds. This sets the frequency for ALL PWM channels
      on this timer. All channels share the same period/frequency.
      
      Use the standard PWM period helpers for convenience:
      - PWM_HZ(1000) for 1kHz
      - PWM_KHZ(20) for 20kHz  
      - PWM_USEC(50) for 50µs period
      - PWM_NSEC(25000) for 25µs period

  st,break-enable:
    type: boolean
    description: |
      Enable the break feature.
      This feature is used to stop the timer when a fault occurs.
      The fault can be generated by an external event or by the software.
      The timer can be restarted by the software or by an external event.

  st,break-polarity:
    type: string
    enum:
      - "low"
      - "high"
    default: "low"
    description: |
      Select the break polarity for the timer.
      This is used to stop the timer when a fault occurs.
      The value is a bitmask of the break polarities
      defined in the STM32 reference manual.

  st,break2-enable:
    type: boolean
    description: |
      Enable the break2 feature.
      This feature is used to stop the timer when a fault occurs.
      The fault can be generated by an external event or by the software.
      The timer can be restarted by the software or by an external event.

  st,break2-polarity:
    type: string
    enum:
      - "low"
      - "high"
    default: "low"
    description: |
      Select the break2 polarity for the timer.
      This is used to stop the timer when a fault occurs.
      The value is a bitmask of the break2 polarities
      defined in the STM32 reference manual.

  st,dead-time:
    type: int
    default: 0
    description: |
      Set the dead time value for the timer.

  st,cc-dma-channels:
    type: array
    description: |
      Optional list of 1-based compare channels that should assert DMA requests
      when the corresponding PWM output is enabled. Channels not listed keep
      their DMA request masked. This allows firmware to arm DMA only for the
      flows that require it while leaving other channels serviced by interrupts.

  st,ossr:
    type: boolean
    description: |
      Off-State Selection for Run mode.
      When enabled, the timer outputs are forced to their inactive level
      when the MOE bit is reset (run mode).

  st,ossi:
    type: boolean
    description: |
      Off-State Selection for Idle mode.
      When enabled, the timer outputs are forced to their inactive level
      when the MOE bit is reset (idle mode).

  st,lock-level:
    type: int
    enum: [0, 1, 2, 3]
    description: |
      Lock level for the timer configuration.
      0: LOCK OFF - No bit is write protected
      1: LOCK Level 1 - DTG bits in TIMx_BDTR register, OISx and OISxN bits in TIMx_CR2 register and BKE/BKP/AOE/DTG[7:0] in TIMx_BDTR register can no longer be written
      2: LOCK Level 2 - LOCK Level 1 + CC Polarity bits (CCxP/CCxNP bits in TIMx_CCER register) can no longer be written
      3: LOCK Level 3 - LOCK Level 2 + CC Control bits (OCxM and OCxPE bits in TIMx_CCMRx registers) can no longer be written

  st,automatic-output:
    type: boolean
    description: |
      Enable automatic output (AOE - Automatic Output Enable).
      When enabled, the MOE bit is automatically set by a hardware event (update event).
      This allows the timer outputs to be automatically re-enabled after a break event.
      When disabled, the MOE bit can only be set by software.

  "#pwm-cells":
    const: 2
    description: |
      Number of items to expect in a PWM
      - channel of the timer used for PWM
      - flags : combination of standard flags like PWM_POLARITY_NORMAL
        or specific flags like STM32_PWM_COMPLEMENTARY. As an example,
        the following complementary PWMs(CH2&CH2N) are shown below.
          <&pwm1 2 (PWM_POLARITY_NORMAL)>;
          <&pwm1 2 (PWM_POLARITY_NORMAL | STM32_PWM_COMPLEMENTARY)>;

pwm-cells:
  - channel
  - flags
